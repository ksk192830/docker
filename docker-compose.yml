# 도커 컴포즈 파일 형식 버전을 지정합니다.
version: '3.8'

# 'services' 아래에 우리가 실행할 컨테이너들을 정의합니다.
services:

  # 1. 'web' 서비스 (우리의 파이썬 앱)
  web:
    # 'build': Dockerfile이 있는 폴더를 지정하여 이미지를 빌드합니다.
    build: ./web
    # 'ports': <내 PC 포트>:<컨테이너 포트> 를 연결합니다.
    ports:
      - "8080:8080"
    # 'depends_on': web 서비스가 시작하기 전에 redis 서비스가 먼저 실행되도록 순서를 정합니다.
    depends_on:
      - redis

  # 2. 'redis' 서비스 (데이터베이스)
  redis:
    # 'image': Docker Hub에서 미리 만들어진 공식 redis 이미지를 가져옵니다.
    image: "redis:alpine"
    # 'volumes': 컨테이너의 /data 폴더를 'redis-data'라는 이름의 볼륨과 연결합니다.
    volumes:
      - redis-data:/data

# 위에서 사용한 'redis-data' 볼륨을 공식적으로 정의합니다.
# 이렇게 정의하면 컨테이너가 삭제되어도 데이터는 보존됩니다.
volumes:
  redis-data: